
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>cartoframes.context module &#8212; cartoframes 0.4.0b6 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.4.0b6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-cartoframes.context">
<span id="cartoframes-context-module"></span><h1>cartoframes.context module<a class="headerlink" href="#module-cartoframes.context" title="Permalink to this headline">¶</a></h1>
<p>CartoContext and BatchJobStatus classes</p>
<dl class="class">
<dt id="cartoframes.context.BatchJobStatus">
<em class="property">class </em><code class="descclassname">cartoframes.context.</code><code class="descname">BatchJobStatus</code><span class="sig-paren">(</span><em>carto_context</em>, <em>job</em><span class="sig-paren">)</span><a class="headerlink" href="#cartoframes.context.BatchJobStatus" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Status of a write or query operation. Read more at <a class="reference external" href="https://carto.com/docs/carto-engine/sql-api/batch-queries/">Batch SQL API docs</a> about
responses and how to interpret them.</p>
<p class="rubric">Example</p>
<p>Poll for a job’s status if you’ve caught the <a class="reference internal" href="#cartoframes.context.BatchJobStatus" title="cartoframes.context.BatchJobStatus"><code class="xref py py-obj docutils literal"><span class="pre">BatchJobStatus</span></code></a>
instance.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="n">job</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;new_table&#39;</span><span class="p">,</span>
               <span class="n">lnglat</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;lng_col&#39;</span><span class="p">,</span> <span class="s1">&#39;lat_col&#39;</span><span class="p">))</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">curr_status</span> <span class="o">=</span> <span class="n">job</span><span class="o">.</span><span class="n">status</span><span class="p">()[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">curr_status</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">,</span> <span class="s1">&#39;failed&#39;</span><span class="p">,</span> <span class="s1">&#39;canceled&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">,</span> <span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">curr_status</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>Create a <a class="reference internal" href="#cartoframes.context.BatchJobStatus" title="cartoframes.context.BatchJobStatus"><code class="xref py py-obj docutils literal"><span class="pre">BatchJobStatus</span></code></a> instance if you have a <cite>job_id</cite> output
from a <cite>cc.write</cite> operation.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">cartoframes</span> <span class="k">import</span> <span class="n">CartoContext</span><span class="p">,</span> <span class="n">BatchJobStatus</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cc</span> <span class="o">=</span> <span class="n">CartoContext</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;...&#39;</span><span class="p">,</span> <span class="n">api_key</span><span class="o">=</span><span class="s1">&#39;...&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cc</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;new_table&#39;</span><span class="p">,</span> <span class="n">lnglat</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;lng&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">))</span>
<span class="go">&#39;BatchJobStatus(job_id=&#39;job-id-string&#39;, ...)&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">batch_job</span> <span class="o">=</span> <span class="n">BatchJobStatus</span><span class="p">(</span><span class="n">cc</span><span class="p">,</span> <span class="s1">&#39;job-id-string&#39;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Attrs:</dt>
<dd>job_id (str): Job ID of the Batch SQL API job
last_status (str): Status of <code class="docutils literal"><span class="pre">job_id</span></code> job when last polled
created_at (str): Time and date when job was created</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>carto_context</strong> (<em>carto.CartoContext</em>) – CartoContext instance</li>
<li><strong>job</strong> (<em>dict</em><em> or </em><em>str</em>) – If a dict, job status dict returned after sending
a Batch SQL API request. If str, a Batch SQL API job id.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="cartoframes.context.BatchJobStatus.get_status">
<code class="descname">get_status</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#cartoframes.context.BatchJobStatus.get_status" title="Permalink to this definition">¶</a></dt>
<dd><p>return current status of job</p>
</dd></dl>

<dl class="method">
<dt id="cartoframes.context.BatchJobStatus.status">
<code class="descname">status</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#cartoframes.context.BatchJobStatus.status" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks the current status of job <code class="docutils literal"><span class="pre">job_id</span></code></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Status and time it was updated</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">dict</td>
</tr>
<tr class="field-odd field"><th class="field-name">Warns:</th><td class="field-body"><strong>UserWarning</strong> – If the job failed, a warning is raised with
information about the failure</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="cartoframes.context.CartoContext">
<em class="property">class </em><code class="descclassname">cartoframes.context.</code><code class="descname">CartoContext</code><span class="sig-paren">(</span><em>base_url=None</em>, <em>api_key=None</em>, <em>creds=None</em>, <em>session=None</em>, <em>verbose=0</em><span class="sig-paren">)</span><a class="headerlink" href="#cartoframes.context.CartoContext" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>CartoContext class for authentication with CARTO and high-level operations
such as reading tables from CARTO into dataframes, writing dataframes to
CARTO tables, creating custom maps from dataframes and CARTO tables, and
augmenting data using CARTO’s <a class="reference external" href="https://carto.com/data-observatory">Data Observatory</a>. Future methods will interact with
CARTO’s services like <a class="reference external" href="https://carto.com/location-data-services/">routing, geocoding, and isolines</a>, PostGIS backend for spatial
processing, and much more.</p>
<p>Manages connections with CARTO for data and map operations. Modeled
after <a class="reference external" href="https://jaceklaskowski.gitbooks.io/mastering-apache-spark/content/spark-sparkcontext.html">SparkContext</a>.</p>
<dl class="attribute">
<dt id="cartoframes.context.CartoContext.creds">
<code class="descname">creds</code><a class="headerlink" href="#cartoframes.context.CartoContext.creds" title="Permalink to this definition">¶</a></dt>
<dd><p><em>cartoframes.Credentials</em> – <code class="xref py py-obj docutils literal"><span class="pre">Credentials</span></code> instance</p>
</dd></dl>

<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>base_url</strong> (<em>str</em>) – Base URL of CARTO user account. Cloud-based accounts
should use the form <code class="docutils literal"><span class="pre">https://{username}.carto.com</span></code> (e.g.,
<a class="reference external" href="https://eschbacher.carto.com">https://eschbacher.carto.com</a> for user <code class="docutils literal"><span class="pre">eschbacher</span></code>) whether on
a personal or multi-user account. On-premises installation users
should ask their admin.</li>
<li><strong>api_key</strong> (<em>str</em>) – CARTO API key.</li>
<li><strong>session</strong> (<em>requests.Session</em><em>, </em><em>optional</em>) – requests session. See <a class="reference external" href="http://docs.python-requests.org/en/master/user/advanced/">requests
documentation</a>
for more information.</li>
<li><strong>verbose</strong> (<em>bool</em><em>, </em><em>optional</em>) – Output underlying process states (True), or
suppress (False, default)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A CartoContext object that is authenticated
against the user’s CARTO account.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#cartoframes.context.CartoContext" title="cartoframes.context.CartoContext"><code class="xref py py-obj docutils literal"><span class="pre">CartoContext</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<p>Create a CartoContext object:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cartoframes</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">cartoframes</span><span class="o">.</span><span class="n">CartoContext</span><span class="p">(</span><span class="n">BASEURL</span><span class="p">,</span> <span class="n">APIKEY</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="cartoframes.context.CartoContext.data">
<code class="descname">data</code><span class="sig-paren">(</span><em>table_name</em>, <em>metadata</em>, <em>persist_as=None</em>, <em>how='the_geom'</em><span class="sig-paren">)</span><a class="headerlink" href="#cartoframes.context.CartoContext.data" title="Permalink to this definition">¶</a></dt>
<dd><p>Get an augmented CARTO dataset with <a class="reference external" href="https://carto.com/data-observatory">Data Observatory</a> measures. Use
<a class="reference external" href="#context.CartoContext.data_discovery">CartoContext.data_discovery</a> to search for available
measures, or see the full <a class="reference external" href="https://cartodb.github.io/bigmetadata/index.html">Data Observatory catalog</a>. Optionally
persist the data as a new table.</p>
<p class="rubric">Example</p>
<p>Get a DataFrame with Data Observatory measures based on the
geometries in a CARTO table.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">cc</span> <span class="o">=</span> <span class="n">cartoframes</span><span class="o">.</span><span class="n">CartoContext</span><span class="p">(</span><span class="n">BASEURL</span><span class="p">,</span> <span class="n">APIKEY</span><span class="p">)</span>
<span class="n">median_income</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">data_discovery</span><span class="p">(</span><span class="s1">&#39;transaction_events&#39;</span><span class="p">,</span>
                                  <span class="n">regex</span><span class="o">=</span><span class="s1">&#39;.*median income.*&#39;</span><span class="p">,</span>
                                  <span class="n">time</span><span class="o">=</span><span class="s1">&#39;2011 - 2015&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">median_income</span><span class="p">,</span>
             <span class="s1">&#39;transaction_event&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Pass in cherry-picked measures from the Data Observatory catalog.
The rest of the metadata will be filled in, but it’s important to
specify the geographic level as this will not show up in the column
name.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">median_income</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;numer_id&#39;</span><span class="p">:</span> <span class="s1">&#39;us.census.acs.B19013001&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;geom_id&#39;</span><span class="p">:</span> <span class="s1">&#39;us.census.tiger.block_group&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;numer_timespan&#39;</span><span class="p">:</span> <span class="s1">&#39;2011 - 2015&#39;</span><span class="p">}]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="s1">&#39;transaction_events&#39;</span><span class="p">,</span> <span class="n">median_income</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>table_name</strong> (<em>str</em>) – Name of table on CARTO account that Data
Observatory measures are to be added to.</li>
<li><strong>metadata</strong> (<em>pandas.DataFrame</em>) – List of all measures to add to
<cite>table_name</cite>. See <cite>CartoContext.data_discovery</cite> outputs
for a full list of metadata columns.</li>
<li><strong>persist_as</strong> (<em>str</em><em>, </em><em>optional</em>) – Output the results of augmenting
<cite>table_name</cite> to <cite>persist_as</cite> as a persistent table on CARTO.
Defaults to <code class="docutils literal"><span class="pre">None</span></code>, which will not create a table.</li>
<li><strong>how</strong> (<em>str</em><em>, </em><em>optional</em>) – <strong>Not fully implemented</strong>. Column name for
identifying the geometry from which to fetch the data. Defaults
to <cite>the_geom</cite>, which results in measures that are spatially
interpolated (e.g., a neighborhood boundary’s population will
be calculated from underlying census tracts). Specifying a
column that has the geometry identifier (for example, GEOID for
US Census boundaries), results in measures directly from the
Census for that GEOID but normalized how it is specified in the
metadata.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A DataFrame representation of <cite>table_name</cite> which
has new columns for each measure in <cite>metadata</cite>.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first">pandas.DataFrame</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first last simple">
<li><code class="xref py py-exc docutils literal"><span class="pre">NameError</span></code> – If the columns in <cite>table_name</cite> are in the
<code class="docutils literal"><span class="pre">suggested_name</span></code> column of <cite>metadata</cite>.</li>
<li><code class="xref py py-exc docutils literal"><span class="pre">ValueError</span></code> – If metadata object is invalid or empty, or if the
number of requested measures exceeds 50.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cartoframes.context.CartoContext.data_augment">
<code class="descname">data_augment</code><span class="sig-paren">(</span><em>table_name</em>, <em>metadata</em><span class="sig-paren">)</span><a class="headerlink" href="#cartoframes.context.CartoContext.data_augment" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="cartoframes.context.CartoContext.data_boundaries">
<code class="descname">data_boundaries</code><span class="sig-paren">(</span><em>df=None</em>, <em>table_name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#cartoframes.context.CartoContext.data_boundaries" title="Permalink to this definition">¶</a></dt>
<dd><p>Not currently implemented</p>
</dd></dl>

<dl class="method">
<dt id="cartoframes.context.CartoContext.data_discovery">
<code class="descname">data_discovery</code><span class="sig-paren">(</span><em>region</em>, <em>keywords=None</em>, <em>regex=None</em>, <em>time=None</em>, <em>boundaries=None</em><span class="sig-paren">)</span><a class="headerlink" href="#cartoframes.context.CartoContext.data_discovery" title="Permalink to this definition">¶</a></dt>
<dd><p>Discover Data Observatory measures. This method returns the full
Data Observatory metadata model for each measure or measures that
match the conditions from the inputs. The full metadata in each row
uniquely defines a measure based on the timespan, geographic
resolution, and normalization (if any). Read more about the metadata
response in <a class="reference external" href="https://carto.com/docs/carto-engine/data/measures-functions/#obs_getmetaextent-geometry-metadata-json-max_timespan_rank-max_score_rank-target_geoms">Data Observatory</a>
documentation.</p>
<p>Internally, this method finds all measures in <cite>region</cite> that match the
conditions set in <cite>keywords</cite>, <cite>regex</cite>, <cite>time</cite>, and <cite>boundaries</cite> (if
any of them are specified). Then, if <cite>boundaries</cite> is not specified, a
geographical resolution for that measure will be chosen subject to the
type of region specified:</p>
<blockquote>
<div><ol class="arabic simple">
<li>If <cite>region</cite> is a table name, then a geographical resolution that
is roughly equal to <cite>region size / number of subunits</cite>.</li>
<li>If <cite>region</cite> is a country name or bounding box, then a geographical
resolution will be chosen roughly equal to <cite>region size / 500</cite>.</li>
</ol>
</div></blockquote>
<p>Since different measures are in some geographic resolutions and not
others, different geographical resolutions for different measures are
oftentimes returned.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">To remove the guesswork in how geographical resolutions are
selected, specify one or more boundaries in <cite>boundaries</cite>. See
the boundaries section for each region in the <a class="reference external" href="http://cartodb.github.io/bigmetadata/">Data Observatory
catalog</a>.</p>
</div>
<p>The metadata returned from this method can then be used to create raw
tables or for augmenting an existing table from these measures using
<cite>CartoContext.data</cite>. For the full Data Observatory catalog, visit
<a class="reference external" href="https://cartodb.github.io/bigmetadata/">https://cartodb.github.io/bigmetadata/</a>. When working with the metadata
DataFrame returned from this method, be careful to only remove rows not
columns as <a class="reference external" href="#context.CartoContext.data">CartoContext.data</a> generally
needs the full metadata.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Narrowing down a discovery query using the <cite>keywords</cite>, <cite>regex</cite>, and
<cite>time</cite> filters is important for getting a manageable metadata
set. Besides there being a large number of measures in the DO, a
metadata response has acceptable combinations of measures with
demonimators (normalization and density), the same measure from
other years, and quantiles measurements.</p>
<p class="last">For example, setting the region to be United States counties with
no filter values set will result in many thousands of measures.</p>
</div>
<p class="rubric">Examples</p>
<p>Get all European Union measures that mention <code class="docutils literal"><span class="pre">freight</span></code>.</p>
<div class="code highlight-default"><div class="highlight"><pre><span></span><span class="n">meta</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">data_discovery</span><span class="p">(</span><span class="s1">&#39;European Union&#39;</span><span class="p">,</span>
                         <span class="n">keywords</span><span class="o">=</span><span class="s1">&#39;freight&#39;</span><span class="p">,</span>
                         <span class="n">time</span><span class="o">=</span><span class="s1">&#39;2010&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;numer_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>region</strong> (<em>str</em><em> or </em><em>list of float</em>) – <p>Information about the region of
interest. <cite>region</cite> can be one of three types:</p>
<blockquote>
<div><ul>
<li>region name (str): Name of region of interest. Acceptable
values are limited to: ‘Australia’, ‘Brazil’, ‘Canada’,
‘European Union’, ‘France’, ‘Mexico’, ‘Spain’,
‘United Kingdom’, ‘United States’.</li>
<li>table name (str): Name of a table in user’s CARTO account
with geometries. The region will be the bounding box of
the table.<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If a table name is also a valid Data Observatory
region name, the Data Observatory name will be chosen
over the table.</p>
</div>
</li>
<li>bounding box (list of float): List of four values (two
lng/lat pairs) in the following order: western longitude,
southern latitude, eastern longitude, and northern latitude.
For example, Switzerland fits in
<code class="docutils literal"><span class="pre">[5.9559111595,45.8179931641,10.4920501709,47.808380127]</span></code></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Geometry levels are generally chosen by subdividing
the region into the next smallest administrative unit. To
override this behavior, specify the <cite>boundaries</cite> flag. For
example, set <cite>boundaries</cite> to
<code class="docutils literal"><span class="pre">'us.census.tiger.census_tract'</span></code> to choose US census
tracts.</p>
</div>
</div></blockquote>
</li>
<li><strong>keywords</strong> (<em>str</em><em> or </em><em>list of str</em><em>, </em><em>optional</em>) – Keyword or list of
keywords in measure description or name. Response will be matched
on all keywords listed (boolean <cite>or</cite>).</li>
<li><strong>regex</strong> (<em>str</em><em>, </em><em>optional</em>) – A regular expression to search the measure
descriptions and names. Note that this relies on PostgreSQL’s
case insensitive operator <code class="docutils literal"><span class="pre">~*</span></code>. See <a class="reference external" href="https://www.postgresql.org/docs/9.5/static/functions-matching.html">PostgreSQL docs</a>
for more information.</li>
<li><strong>boundaries</strong> (<em>str</em><em> or </em><em>list of str</em><em>, </em><em>optional</em>) – Boundary or list of
boundaries that specify the measure resolution. See the
boundaries section for each region in the <a class="reference external" href="http://cartodb.github.io/bigmetadata/">Data Observatory
catalog</a>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">A dataframe of the complete metadata model for
specific measures based on the search parameters.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first">pandas.DataFrame</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal"><span class="pre">ValueError</span></code> – If <cite>region</cite> is a <code class="xref py py-obj docutils literal"><span class="pre">list</span></code> and does not consist of
four elements, or if <cite>region</cite> is neither an acceptable region
nor a table in user account.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cartoframes.context.CartoContext.delete">
<code class="descname">delete</code><span class="sig-paren">(</span><em>table_name</em><span class="sig-paren">)</span><a class="headerlink" href="#cartoframes.context.CartoContext.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete a table in user’s CARTO account.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>table_name</strong> (<em>str</em>) – Name of table to delete</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">None</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cartoframes.context.CartoContext.map">
<code class="descname">map</code><span class="sig-paren">(</span><em>layers=None</em>, <em>interactive=True</em>, <em>zoom=None</em>, <em>lat=None</em>, <em>lng=None</em>, <em>size=(800</em>, <em>400)</em>, <em>ax=None</em><span class="sig-paren">)</span><a class="headerlink" href="#cartoframes.context.CartoContext.map" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce a CARTO map visualizing data layers.</p>
<p class="rubric">Examples</p>
<p>Create a map with two data layers, and one BaseMap layer:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cartoframes</span>
<span class="kn">from</span> <span class="nn">cartoframes</span> <span class="k">import</span> <span class="n">Layer</span><span class="p">,</span> <span class="n">BaseMap</span><span class="p">,</span> <span class="n">styling</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">cartoframes</span><span class="o">.</span><span class="n">CartoContext</span><span class="p">(</span><span class="n">BASEURL</span><span class="p">,</span> <span class="n">APIKEY</span><span class="p">)</span>
<span class="n">cc</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="n">BaseMap</span><span class="p">(),</span>
               <span class="n">Layer</span><span class="p">(</span><span class="s1">&#39;acadia_biodiversity&#39;</span><span class="p">,</span>
                     <span class="n">color</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;column&#39;</span><span class="p">:</span> <span class="s1">&#39;simpson_index&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;scheme&#39;</span><span class="p">:</span> <span class="n">styling</span><span class="o">.</span><span class="n">tealRose</span><span class="p">(</span><span class="mi">7</span><span class="p">)}),</span>
               <span class="n">Layer</span><span class="p">(</span><span class="s1">&#39;peregrine_falcon_nest_sites&#39;</span><span class="p">,</span>
                     <span class="n">size</span><span class="o">=</span><span class="s1">&#39;num_eggs&#39;</span><span class="p">,</span>
                     <span class="n">color</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;column&#39;</span><span class="p">:</span> <span class="s1">&#39;bird_id&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;scheme&#39;</span><span class="p">:</span> <span class="n">styling</span><span class="o">.</span><span class="n">vivid</span><span class="p">(</span><span class="mi">10</span><span class="p">))],</span>
       <span class="n">interactive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Create a snapshot of a map at a specific zoom and center:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cc</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">layers</span><span class="o">=</span><span class="n">Layer</span><span class="p">(</span><span class="s1">&#39;acadia_biodiversity&#39;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;simpson_index&#39;</span><span class="p">),</span>
       <span class="n">interactive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
       <span class="n">zoom</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
       <span class="n">lng</span><span class="o">=-</span><span class="mf">68.3823549</span><span class="p">,</span>
       <span class="n">lat</span><span class="o">=</span><span class="mf">44.3036906</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>layers</strong> (<em>list</em><em>, </em><em>optional</em>) – <p>List of one or more of the following:</p>
<ul>
<li>Layer: cartoframes Layer object for visualizing data from a
CARTO table. See <a class="reference external" href="#layer.Layer">layer.Layer</a> for all
styling options.</li>
<li>BaseMap: Basemap for contextualizng data layers. See
<a class="reference external" href="#layer.BaseMap">layer.BaseMap</a> for all styling options.</li>
<li>QueryLayer: Layer from an arbitrary query. See
<a class="reference external" href="#layer.QueryLayer">layer.QueryLayer</a> for all styling
options.</li>
</ul>
</li>
<li><strong>interactive</strong> (<em>bool</em><em>, </em><em>optional</em>) – Defaults to <code class="docutils literal"><span class="pre">True</span></code> to show an
interactive slippy map. Setting to <code class="docutils literal"><span class="pre">False</span></code> creates a static
map.</li>
<li><strong>zoom</strong> (<em>int</em><em>, </em><em>optional</em>) – Zoom level of map. Acceptable values are
usually in the range 0 to 19. 0 has the entire earth on a
single tile (256px square). Zoom 19 is the size of a city
block. Must be used in conjunction with <code class="docutils literal"><span class="pre">lng</span></code> and <code class="docutils literal"><span class="pre">lat</span></code>.
Defaults to a view to have all data layers in view.</li>
<li><strong>lat</strong> (<em>float</em><em>, </em><em>optional</em>) – Latitude value for the center of the map.
Must be used in conjunction with <code class="docutils literal"><span class="pre">zoom</span></code> and <code class="docutils literal"><span class="pre">lng</span></code>. Defaults
to a view to have all data layers in view.</li>
<li><strong>lng</strong> (<em>float</em><em>, </em><em>optional</em>) – Longitude value for the center of the map.
Must be used in conjunction with <code class="docutils literal"><span class="pre">zoom</span></code> and <code class="docutils literal"><span class="pre">lat</span></code>. Defaults
to a view to have all data layers in view.</li>
<li><strong>size</strong> (<em>tuple</em><em>, </em><em>optional</em>) – List of pixel dimensions for the map.
Format is <code class="docutils literal"><span class="pre">(width,</span> <span class="pre">height)</span></code>. Defaults to <code class="docutils literal"><span class="pre">(800,</span> <span class="pre">400)</span></code>.</li>
<li><strong>ax</strong> – matplotlib axis on which to draw the image. Only used when
<code class="docutils literal"><span class="pre">interactive</span></code> is <code class="docutils literal"><span class="pre">False</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Interactive maps are
rendered as HTML in an <cite>iframe</cite>, while static maps are returned as
matplotlib Axes objects or IPython Image.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">IPython.display.HTML or matplotlib Axes</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cartoframes.context.CartoContext.query">
<code class="descname">query</code><span class="sig-paren">(</span><em>query</em>, <em>table_name=None</em>, <em>decode_geom=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cartoframes.context.CartoContext.query" title="Permalink to this definition">¶</a></dt>
<dd><p>Pull the result from an arbitrary SQL query from a CARTO account
into a pandas DataFrame. Can also be used to perform database
operations (creating/dropping tables, adding columns, updates, etc.).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>query</strong> (<em>str</em>) – Query to run against CARTO user database. This data
will then be converted into a pandas DataFrame.</li>
<li><strong>table_name</strong> (<em>str</em><em>, </em><em>optional</em>) – If set, this will create a new
table in the user’s CARTO account that is the result of the
query. Defaults to None (no table created).</li>
<li><strong>decode_geom</strong> (<em>bool</em><em>, </em><em>optional</em>) – Decodes CARTO’s geometries into a
<a class="reference external" href="https://github.com/Toblerity/Shapely">Shapely</a>
object that can be used, for example, in <a class="reference external" href="http://geopandas.org/">GeoPandas</a>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">DataFrame representation of query supplied.
Pandas data types are inferred from PostgreSQL data types.
In the case of PostgreSQL date types, dates are attempted to be
converted, but on failure a data type ‘object’ is used.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">pandas.DataFrame</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cartoframes.context.CartoContext.read">
<code class="descname">read</code><span class="sig-paren">(</span><em>table_name</em>, <em>limit=None</em>, <em>index='cartodb_id'</em>, <em>decode_geom=False</em><span class="sig-paren">)</span><a class="headerlink" href="#cartoframes.context.CartoContext.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a table from CARTO into a pandas DataFrames.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>table_name</strong> (<em>str</em>) – Name of table in user’s CARTO account.</li>
<li><strong>limit</strong> (<em>int</em><em>, </em><em>optional</em>) – Read only <cite>limit</cite> lines from
<cite>table_name</cite>. Defaults to <code class="docutils literal"><span class="pre">None</span></code>, which reads the full table.</li>
<li><strong>index</strong> (<em>str</em><em>, </em><em>optional</em>) – Not currently in use.</li>
<li><strong>decode_geom</strong> (<em>bool</em><em>, </em><em>optional</em>) – Decodes CARTO’s geometries into a
<a class="reference external" href="https://github.com/Toblerity/Shapely">Shapely</a>
object that can be used, for example, in <a class="reference external" href="http://geopandas.org/">GeoPandas</a>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">DataFrame representation of <cite>table_name</cite> from
CARTO.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">pandas.DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Example</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cartoframes</span>
<span class="n">cc</span> <span class="o">=</span> <span class="n">cartoframes</span><span class="o">.</span><span class="n">CartoContext</span><span class="p">(</span><span class="n">BASEURL</span><span class="p">,</span> <span class="n">APIKEY</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;acadia_biodiversity&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="cartoframes.context.CartoContext.sync">
<code class="descname">sync</code><span class="sig-paren">(</span><em>dataframe</em>, <em>table_name</em><span class="sig-paren">)</span><a class="headerlink" href="#cartoframes.context.CartoContext.sync" title="Permalink to this definition">¶</a></dt>
<dd><p>Depending on the size of the DataFrame or CARTO table, perform
granular operations on a DataFrame to only update the changed cells
instead of a bulk upload. If on the large side, perform granular
operations, if on the smaller side use Import API.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Not yet implemented.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="cartoframes.context.CartoContext.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>df</em>, <em>table_name</em>, <em>temp_dir='/Users/peschbacher/Library/Caches/cartoframes'</em>, <em>overwrite=False</em>, <em>lnglat=None</em>, <em>encode_geom=False</em>, <em>geom_col=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#cartoframes.context.CartoContext.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write a DataFrame to a CARTO table.</p>
<p class="rubric">Example</p>
<p>Write a pandas DataFrame to CARTO.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">cc</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;brooklyn_poverty&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Scrape an HTML table from Wikipedia and send to CARTO with content
guessing to create a geometry from the country column. This uses
a CARTO Import API param <cite>content_guessing</cite> parameter.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://en.wikipedia.org/wiki/List_of_countries_by_life_expectancy&#39;</span>
<span class="c1"># retrieve first HTML table from that page</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># send to carto, let it guess polygons based on the &#39;country&#39;</span>
<span class="c1">#   column. Also set privacy to &#39;public&#39;</span>
<span class="n">cc</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;life_expectancy&#39;</span><span class="p">,</span>
         <span class="n">content_guessing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
         <span class="n">privacy</span><span class="o">=</span><span class="s1">&#39;public&#39;</span><span class="p">)</span>
<span class="n">cc</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">layers</span><span class="o">=</span><span class="n">Layer</span><span class="p">(</span><span class="s1">&#39;life_expectancy&#39;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;both_sexes_life_expectancy&#39;</span><span class="p">))</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>df</strong> (<em>pandas.DataFrame</em>) – DataFrame to write to <code class="docutils literal"><span class="pre">table_name</span></code> in user
CARTO account</li>
<li><strong>table_name</strong> (<em>str</em>) – Table to write <code class="docutils literal"><span class="pre">df</span></code> to in CARTO.</li>
<li><strong>temp_dir</strong> (<em>str</em><em>, </em><em>optional</em>) – Directory for temporary storage of data
that is sent to CARTO. Defaults are defined by <a class="reference external" href="https://github.com/ActiveState/appdirs/blob/master/README.rst">appdirs</a>.</li>
<li><strong>overwrite</strong> (<em>bool</em><em>, </em><em>optional</em>) – Behavior for overwriting <code class="docutils literal"><span class="pre">table_name</span></code>
if it exits on CARTO. Defaults to <code class="docutils literal"><span class="pre">False</span></code>.</li>
<li><strong>lnglat</strong> (<em>tuple</em><em>, </em><em>optional</em>) – lng/lat pair that can be used for
creating a geometry on CARTO. Defaults to <code class="docutils literal"><span class="pre">None</span></code>. In some
cases, geometry will be created without specifying this. See
CARTO’s <a class="reference external" href="https://carto.com/docs/carto-engine/import-api/standard-tables">Import API</a>
for more information.</li>
<li><strong>encode_geom</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to write <cite>geom_col</cite> to CARTO
as <cite>the_geom</cite>.</li>
<li><strong>geom_col</strong> (<em>str</em><em>, </em><em>optional</em>) – The name of the column where geometry
information is stored. Used in conjunction with
<cite>encode_geom</cite>.</li>
<li><strong>kwargs</strong> – Keyword arguments from CARTO’s Import API. See the <a class="reference external" href="https://carto.com/docs/carto-engine/import-api/standard-tables/#params">params
listed in the documentation</a>
for more information. For example, when using
<cite>content_guessing=’true’</cite>, a column named ‘countries’ with
country names will be used to generate polygons for each
country. To avoid unintended consequences, avoid <cite>file</cite>, <cite>url</cite>,
and other similar arguments. Note: Combining <cite>privacy</cite> with
<cite>overwrite</cite> (defined above) does not currently update the
privacy of a dataset: <a class="reference external" href="https://github.com/CartoDB/cartoframes/issues/252">https://github.com/CartoDB/cartoframes/issues/252</a>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">If <cite>lnglat</cite> flag is set and the
DataFrame has more than 100,000 rows, a <a class="reference internal" href="#cartoframes.context.BatchJobStatus" title="cartoframes.context.BatchJobStatus"><code class="xref py py-obj docutils literal"><span class="pre">BatchJobStatus</span></code></a>
instance is returned. Otherwise, None.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#cartoframes.context.BatchJobStatus" title="cartoframes.context.BatchJobStatus"><code class="xref py py-obj docutils literal"><span class="pre">BatchJobStatus</span></code></a> or None</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">DataFrame indexes are changed to ordinary columns. CARTO creates
an index called <cite>cartodb_id</cite> for every table that runs from 1 to
the length of the DataFrame.</p>
</div>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/cartoframes.context.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Andy Eschbacher, Stuart Lynn.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/cartoframes.context.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>